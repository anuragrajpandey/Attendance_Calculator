<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Attendance — Mobile Optimized</title>
<style>
  /* Mobile-first, simple & fast */
  :root{
    --bg: #f5f7fb;
    --card: #ffffff;
    --muted: #6b7280;
    --text: #0b1220;
    --accent: #0ea5e9;
    --good: #10b981;
    --bad: #ef4444;
    --radius:12px;
    --hit: 48px; /* minimal touch target */
  }

  *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
  html,body{height:100%; margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; background:var(--bg); color:var(--text); -webkit-text-size-adjust:100%;}
  body{display:flex;align-items:flex-start;justify-content:center;padding:14px 12px;gap:12px;}

  /* Container */
  .wrap{width:100%;max-width:980px;background:var(--card);border-radius:14px;padding:12px;box-shadow:0 8px 24px rgba(2,6,23,0.06); border:1px solid rgba(2,6,23,0.04); display:flex;flex-direction:column;gap:12px}
  
  /* HEAD */
  .head{display:flex;align-items:center;justify-content:space-between;gap:8px}
  .title{font-weight:800;font-size:18px}
  .subtitle{font-size:12px;color:var(--muted)}

  /* Targets row */
  .targets{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
  .target{
    padding:10px 12px;border-radius:999px;border:1px solid rgba(2,6,23,0.06);background:transparent;font-weight:800;font-size:14px;
    min-height:var(--hit); display:inline-flex;align-items:center;justify-content:center; cursor:pointer;
  }
  .target.active{background:var(--accent);color:white;border:0; box-shadow:0 8px 20px rgba(14,165,233,0.12)}

  /* Inputs - full width on mobile */
  .grid{display:grid;grid-template-columns:1fr;gap:8px}
  .label{font-size:13px;color:var(--muted);margin-bottom:6px}
  .input{
    width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(2,6,23,0.06);font-size:16px;background:transparent;
    -webkit-appearance:none;appearance:none;
  }

  /* Buttons */
  .row{display:flex;gap:8px}
  .btn{flex:1;padding:12px;border-radius:12px;border:0;font-weight:900;font-size:15px;cursor:pointer;min-height:var(--hit)}
  .btn.primary{background:var(--accent);color:#fff}
  .btn.ghost{background:transparent;border:1px solid rgba(2,6,23,0.06);color:var(--muted)}

  /* Display area */
  .display{padding:12px;border-radius:12px;background:rgba(2,6,23,0.02);display:flex;flex-direction:column;gap:12px}
  .top{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .percent{font-weight:900;font-size:32px}
  .status{padding:6px 10px;border-radius:999px;font-weight:800;font-size:13px}
  .status.ok{background:rgba(16,185,129,0.12);color:var(--good)}
  .status.low{background:rgba(239,68,68,0.12);color:var(--bad)}
  .muted{color:var(--muted);font-size:13px}

  .panel-row{display:flex;justify-content:space-between;align-items:center;gap:12px}
  .panel-small{display:flex;flex-direction:column;gap:6px;min-width:0}
  .bunk{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:10px;background:rgba(2,6,23,0.02);font-weight:800}
  .message{padding:10px;border-radius:10px;background:rgba(14,165,233,0.04);font-weight:700;text-align:center}

  footer{display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:13px;padding-top:4px}

  /* Make inputs big on very small screens and improve spacing */
  @media(min-width:760px){
    .wrap{flex-direction:row; padding:18px; align-items:flex-start}
    .left{width:360px;flex-shrink:0;display:flex;flex-direction:column;gap:10px}
    .main{flex:1;display:flex;flex-direction:column;gap:10px}
    .grid{grid-template-columns:1fr 1fr; gap:10px}
    .targets{flex-direction:column;gap:10px}
  }

  /* Accessibility / focus */
  .target:focus, .btn:focus, .input:focus{outline:3px solid rgba(14,165,233,0.13);outline-offset:2px}
</style>
</head>
<body>
  <main class="wrap" role="application" aria-label="Attendance mobile optimized">
    <div class="head">
      <div>
        <div class="title">Attendance</div>
        <div class="subtitle">Mobile optimized • minimal</div>
      </div>
      <div class="muted">Auto-save</div>
    </div>

    <!-- LEFT controls (stacked on mobile) -->
    <section class="left" aria-hidden="false" style="display:flex;flex-direction:column;gap:10px">
      <div class="muted" style="font-weight:700">Targets</div>
      <div class="targets" id="targets">
        <button class="target" data-val="75" aria-pressed="false">75%</button>
        <button class="target" data-val="80" aria-pressed="false">80%</button>
        <button class="target" data-val="85" aria-pressed="false">85%</button>
        <button class="target" data-val="90" aria-pressed="false">90%</button>
      </div>

      <div style="margin-top:4px">
        <div class="label">Total</div>
        <input id="total" class="input" type="number" inputmode="numeric" pattern="[0-9]*" min="0" value="60" />
      </div>

      <div>
        <div class="label">Attended</div>
        <input id="attended" class="input" type="number" inputmode="numeric" pattern="[0-9]*" min="0" value="45" />
      </div>

      <div class="row" style="margin-top:6px">
        <button id="present" class="btn primary" aria-label="Mark present">+ Present</button>
        <button id="absent" class="btn ghost" aria-label="Mark absent">+ Absent</button>
      </div>

      <div style="display:flex;gap:8px;margin-top:6px">
        <input id="upcoming" class="input" type="number" inputmode="numeric" placeholder="Upcoming" />
        <input id="willAttend" class="input" type="number" inputmode="numeric" placeholder="Will attend" />
      </div>

      <div class="row" style="margin-top:6px">
        <button id="apply" class="btn ghost">Apply</button>
        <button id="reset" class="btn ghost">Reset</button>
      </div>
    </section>

    <!-- RIGHT / Main display -->
    <section class="main" style="display:flex;flex-direction:column;gap:10px">
      <div class="display" aria-live="polite">
        <div class="top">
          <div>
            <div class="percent" id="percent">0.00%</div>
            <div class="muted" id="sub">Current</div>
          </div>
          <div id="statusWrap"><span class="status">—</span></div>
        </div>

        <div class="panel-row" style="margin-top:6px">
          <div class="panel-small">
            <div class="muted">Projected</div>
            <div id="proj" style="font-weight:800">0 / 0 — 0.00%</div>
          </div>
          <div class="panel-small">
            <div class="muted">Needed</div>
            <div id="needed" style="font-weight:800">—</div>
          </div>
        </div>

        <div class="bunk" style="margin-top:8px">
          <div class="muted" id="bunkLabel">You can bunk</div>
          <div id="bunkCount" style="font-weight:800">—</div>
        </div>

        <div class="message" id="message" style="margin-top:8px">—</div>
      </div>

      <footer>
        <div class="muted">Simple</div>
        <div class="muted" id="currentTarget">75%</div>
      </footer>
    </section>
  </main>

<script>
/* Mobile-optimized attendance logic
   - mobile-first layout, larger hit areas, numeric keyboard hints
   - revert invalid typed values (attended > total or willAttend > upcoming)
   - present/absent/apply/reset preserved
   - autosave with small JSON, fast update loop
   - minimal DOM writes: update only changed fields
*/

// short selectors
const $ = id => document.getElementById(id);

// DOM
const targets = Array.from(document.querySelectorAll('.target'));
const totalEl = $('total'), attendedEl = $('attended'), upcomingEl = $('upcoming'), willAttendEl = $('willAttend');
const presentBtn = $('present'), absentBtn = $('absent'), applyBtn = $('apply'), resetBtn = $('reset');
const percentEl = $('percent'), statusWrap = $('statusWrap'), projEl = $('proj'), neededEl = $('needed');
const bunkLabel = $('bunkLabel'), bunkCount = $('bunkCount'), messageEl = $('message');
const currentTargetEl = $('currentTarget');

// storage key
const KEY = 'att_mobile_v1';

// simple number parse (safe)
function toInt(v){ const n = parseInt(String(v).replace(/[^\d-]/g,''),10); return isNaN(n) ? 0 : Math.max(0,n); }

// math helpers
function pct(att, tot){ return tot <= 0 ? 0 : (att / tot) * 100; }
function classesNeeded(att, tot, targetPct){
  const t = targetPct/100;
  if(pct(att,tot) >= targetPct) return 0;
  if(t >= 1) return Infinity;
  const numerator = t * tot - att;
  const denom = 1 - t;
  return Math.max(0, Math.ceil(numerator / denom));
}
function maxBunk(att, tot, targetPct){
  const t = targetPct/100;
  if(t === 0) return Infinity;
  if(pct(att,tot) < targetPct) return 0;
  const raw = (att - t*tot)/t;
  return Math.max(0, Math.floor(raw));
}

// prev values to revert invalid typing
let prevAttended = toInt(attendedEl.value);
let prevWillAttend = toInt(willAttendEl.value);

// thin update function (only minimal DOM writes)
let lastState = {};
function update(force){
  const total = toInt(totalEl.value);
  let attended = toInt(attendedEl.value);
  const upcoming = toInt(upcomingEl.value);
  let willAttend = toInt(willAttendEl.value);
  const target = getTarget();

  // typed invalids revert (no surprises)
  if(attended > total){ attendedEl.value = prevAttended; attended = prevAttended; } else prevAttended = attended;
  if(willAttend > upcoming){ willAttendEl.value = prevWillAttend; willAttend = prevWillAttend; } else prevWillAttend = willAttend;

  const safeAtt = Math.min(attended, total);
  const curPct = +(pct(safeAtt, total).toFixed(2));

  // only update DOM if changed from last state (minimize reflow)
  const state = { total, attended: safeAtt, upcoming, willAttend, curPct, target };
  if(!force && JSON.stringify(state) === JSON.stringify(lastState)) return;
  lastState = state;

  // percent
  percentEl.textContent = curPct.toFixed(2) + '%';

  // status badge
  if(total === 0){
    statusWrap.innerHTML = `<span class="status">—</span>`;
  } else if(curPct >= target){
    statusWrap.innerHTML = `<span class="status ok">ON</span>`;
  } else {
    statusWrap.innerHTML = `<span class="status low">LOW</span>`;
  }

  // projection
  const pTot = total + upcoming;
  const pAtt = safeAtt + willAttend;
  projEl.textContent = `${pAtt} / ${pTot} — ${ (pTot===0) ? '0.00%' : pct(pAtt,pTot).toFixed(2)+'%' }`;

  // needed & bunk
  const needed = classesNeeded(attended, total, target);
  neededEl.textContent = needed === Infinity ? 'Impossible' : (needed + (needed===1 ? ' class' : ' classes'));

  if(total === 0 && attended === 0){
    bunkLabel.textContent = 'You can bunk';
    bunkCount.textContent = '—';
    messageEl.textContent = 'Enter values';
  } else if(curPct >= target){
    const bunk = maxBunk(attended, total, target);
    bunkLabel.textContent = 'You can bunk';
    bunkCount.textContent = (bunk === Infinity) ? 'Many' : (bunk + (bunk===1 ? ' class' : ' classes'));
    messageEl.textContent = bunk > 0 ? `You can skip ${bunk} and still meet ${target}%.` : 'On track — keep it up.';
  } else {
    const needCount = needed === Infinity ? 'Impossible' : (needed + (needed===1 ? ' class' : ' classes'));
    bunkLabel.textContent = 'You need';
    bunkCount.textContent = needCount;
    messageEl.textContent = 'Below target — attend more.';
  }

  // persist
  try{ localStorage.setItem(KEY, JSON.stringify({ total, attended, upcoming, willAttend, target })); }catch(e){}
}

// target helpers
function getTarget(){ const a = targets.find(t=>t.classList.contains('active')); return a ? Number(a.dataset.val) : 75; }
function setTarget(v){
  targets.forEach(t => {
    const active = Number(t.dataset.val) === Number(v);
    t.classList.toggle('active', active);
    t.setAttribute('aria-pressed', active ? 'true' : 'false');
  });
  currentTargetEl.textContent = Number(v) + '%';
  update(true);
}
targets.forEach(t => t.addEventListener('click', ()=>{ setTarget(t.dataset.val); }));

// load saved state (fast)
(function load(){
  try{
    const s = JSON.parse(localStorage.getItem(KEY) || '{}');
    if(typeof s.total === 'number') totalEl.value = s.total;
    if(typeof s.attended === 'number') attendedEl.value = s.attended;
    if(typeof s.upcoming === 'number') upcomingEl.value = s.upcoming;
    if(typeof s.willAttend === 'number') willAttendEl.value = s.willAttend;
    if(typeof s.target === 'number') setTarget(s.target);
  }catch(e){}
  // ensure default target if none
  if(!targets.some(t=>t.classList.contains('active'))) setTarget(75);
  update(true);
})();

// Input event wiring (fast, minimal)
attendedEl.addEventListener('focus', ()=> prevAttended = toInt(attendedEl.value));
attendedEl.addEventListener('input', ()=>{
  const entered = toInt(attendedEl.value), total = toInt(totalEl.value);
  if(entered > total){ attendedEl.value = prevAttended; } else { prevAttended = entered; update(); }
});

willAttendEl.addEventListener('focus', ()=> prevWillAttend = toInt(willAttendEl.value));
willAttendEl.addEventListener('input', ()=>{
  const entered = toInt(willAttendEl.value), upcoming = toInt(upcomingEl.value);
  if(entered > upcoming){ willAttendEl.value = prevWillAttend; } else { prevWillAttend = entered; update(); }
});

totalEl.addEventListener('input', ()=>{
  const total = toInt(totalEl.value), attended = toInt(attendedEl.value);
  if(attended > total){ attendedEl.value = total; prevAttended = total; }
  update();
});
upcomingEl.addEventListener('input', update);

// buttons (touch friendly)
presentBtn.addEventListener('click', ()=>{
  totalEl.value = toInt(totalEl.value) + 1;
  attendedEl.value = toInt(attendedEl.value) + 1;
  prevAttended = toInt(attendedEl.value);
  update();
});
absentBtn.addEventListener('click', ()=>{
  totalEl.value = toInt(totalEl.value) + 1;
  update();
});
applyBtn.addEventListener('click', ()=>{
  const upcoming = toInt(upcomingEl.value);
  const willAttend = Math.min(toInt(willAttendEl.value), upcoming);
  totalEl.value = toInt(totalEl.value) + upcoming;
  attendedEl.value = toInt(attendedEl.value) + willAttend;
  prevAttended = toInt(attendedEl.value);
  upcomingEl.value = ''; willAttendEl.value = '';
  update();
});
resetBtn.addEventListener('click', ()=>{
  if(confirm('Reset attendance data?')){
    totalEl.value = 0; attendedEl.value = 0; upcomingEl.value = ''; willAttendEl.value = '';
    setTarget(75);
    localStorage.removeItem(KEY);
    update(true);
  }
});

// keyboard "done" helpfulness: when user finishes numeric input, immediately recalc
[totalEl, attendedEl, upcomingEl, willAttendEl].forEach(inp=>{
  inp.addEventListener('keydown', (e) => {
    if(e.key === 'Enter'){ inp.blur(); update(); }
  });
});

// small accessibility: allow swipe-left/right to change target on small screens (optional convenience)
let touchStartX = null;
document.addEventListener('touchstart', (e) => {
  if(e.touches && e.touches[0]) touchStartX = e.touches[0].clientX;
}, {passive:true});
document.addEventListener('touchend', (e) => {
  if(touchStartX === null) return;
  const endX = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0].clientX : null;
  if(endX === null) return;
  const dx = endX - touchStartX;
  if(Math.abs(dx) > 60 && window.innerWidth < 760){
    // change target - left swipe decreases, right swipe increases
    const order = [75,80,85,90];
    const current = getTarget();
    const idx = order.indexOf(current);
    if(dx < 0 && idx < order.length-1) setTarget(order[idx+1]);
    if(dx > 0 && idx > 0) setTarget(order[idx-1]);
  }
  touchStartX = null;
}, {passive:true});

// initial update on load
update(true);

</script>
</body>
</html>