<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>Attendance Calculator — EliteStocks</title>
<style>
  :root{
    --glass-bg: rgba(255, 255, 255, 0.7);
    --glass-border: rgba(255, 255, 255, 0.3);
    --glass-shadow: rgba(31, 38, 135, 0.15);
    --text-primary: #1a202c;
    --text-secondary: #4a5568;
    --text-muted: #718096;
    --accent: #667eea;
    --accent-hover: #5a67d8;
    --success: #48bb78;
    --danger: #f56565;
    --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    --backdrop: #e6e9f0;
    --radius: 16px;
    --radius-sm: 12px;
  }
  
  * {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }
  
  html, body {
    height: 100%;
    margin: 0;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--backdrop);
    background-image: 
      radial-gradient(at 20% 30%, rgba(102, 126, 234, 0.15) 0px, transparent 50%),
      radial-gradient(at 80% 70%, rgba(245, 87, 108, 0.15) 0px, transparent 50%),
      radial-gradient(at 50% 50%, rgba(118, 75, 162, 0.1) 0px, transparent 50%);
    color: var(--text-primary);
    -webkit-text-size-adjust: 100%;
    overflow-x: hidden;
  }
  
  body {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    min-height: 100vh;
  }

  .container {
    width: 100%;
    max-width: 1100px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* Glass Card Styles */
  .glass {
    background: var(--glass-bg);
    backdrop-filter: blur(16px) saturate(180%);
    -webkit-backdrop-filter: blur(16px) saturate(180%);
    border-radius: var(--radius);
    border: 1px solid var(--glass-border);
    box-shadow: 0 8px 32px var(--glass-shadow);
  }

  /* Header */
  .header {
    padding: 24px 28px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    flex-wrap: wrap;
  }

  .brand {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .brand-title {
    font-size: 28px;
    font-weight: 800;
    background: var(--gradient-1);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    letter-spacing: -0.5px;
  }

  .brand-by {
    font-size: 13px;
    color: var(--text-muted);
    font-weight: 600;
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }

  .brand-name {
    color: var(--accent);
    font-weight: 700;
  }

  .autosave-badge {
    padding: 8px 16px;
    background: rgba(102, 126, 234, 0.1);
    border-radius: 999px;
    font-size: 12px;
    font-weight: 700;
    color: var(--accent);
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .autosave-dot {
    width: 6px;
    height: 6px;
    background: var(--success);
    border-radius: 50%;
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  /* Main Content */
  .content {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    padding: 0 0 20px 0;
  }

  /* Sidebar */
  .sidebar {
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .section-title {
    font-size: 13px;
    font-weight: 700;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 8px;
  }

  /* Targets */
  .targets-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
  }

  .target-btn {
    padding: 14px;
    border: 2px solid rgba(102, 126, 234, 0.2);
    background: rgba(255, 255, 255, 0.5);
    border-radius: var(--radius-sm);
    font-weight: 800;
    font-size: 16px;
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .target-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--gradient-1);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .target-btn span {
    position: relative;
    z-index: 1;
  }

  .target-btn:hover {
    border-color: var(--accent);
    transform: translateY(-2px);
  }

  .target-btn.active {
    border-color: transparent;
    color: white;
  }

  .target-btn.active::before {
    opacity: 1;
  }

  /* Input Group */
  .input-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .input-label {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-secondary);
  }

  .input-field {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid rgba(102, 126, 234, 0.15);
    background: rgba(255, 255, 255, 0.6);
    border-radius: var(--radius-sm);
    font-size: 16px;
    font-weight: 600;
    color: var(--text-primary);
    transition: all 0.3s ease;
    -webkit-appearance: none;
    appearance: none;
  }

  .input-field:focus {
    outline: none;
    border-color: var(--accent);
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .input-field::placeholder {
    color: var(--text-muted);
    font-weight: 500;
  }

  /* Buttons */
  .btn-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }

  .btn {
    padding: 14px;
    border: none;
    border-radius: var(--radius-sm);
    font-weight: 700;
    font-size: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
  }

  .btn:active::before {
    width: 300px;
    height: 300px;
  }

  .btn span {
    position: relative;
    z-index: 1;
  }

  .btn-primary {
    background: var(--gradient-1);
    color: white;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  }

  .btn-primary:hover {
    box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    transform: translateY(-2px);
  }

  .btn-secondary {
    background: rgba(255, 255, 255, 0.6);
    color: var(--text-primary);
    border: 2px solid rgba(102, 126, 234, 0.2);
  }

  .btn-secondary:hover {
    background: rgba(255, 255, 255, 0.9);
    border-color: var(--accent);
    transform: translateY(-2px);
  }

  .btn-danger {
    background: rgba(245, 101, 101, 0.1);
    color: var(--danger);
    border: 2px solid rgba(245, 101, 101, 0.3);
  }

  .btn-danger:hover {
    background: rgba(245, 101, 101, 0.2);
    border-color: var(--danger);
  }

  /* Main Display */
  .main-display {
    padding: 24px;
  }

  .stats-card {
    background: rgba(255, 255, 255, 0.5);
    border-radius: var(--radius);
    padding: 28px;
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  .stats-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
  }

  .percentage-display {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .percentage-value {
    font-size: 56px;
    font-weight: 900;
    background: var(--gradient-1);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1;
    letter-spacing: -2px;
  }

  .percentage-label {
    font-size: 13px;
    color: var(--text-muted);
    font-weight: 600;
  }

  .status-badge {
    padding: 10px 20px;
    border-radius: 999px;
    font-weight: 800;
    font-size: 14px;
    letter-spacing: 0.5px;
  }

  .status-ok {
    background: rgba(72, 187, 120, 0.15);
    color: var(--success);
  }

  .status-low {
    background: rgba(245, 101, 101, 0.15);
    color: var(--danger);
  }

  /* Info Grid */
  .info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  .info-item {
    background: rgba(102, 126, 234, 0.05);
    border-radius: var(--radius-sm);
    padding: 16px;
  }

  .info-label {
    font-size: 12px;
    color: var(--text-muted);
    font-weight: 600;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .info-value {
    font-size: 18px;
    font-weight: 800;
    color: var(--text-primary);
  }

  /* Bunk Card */
  .bunk-card {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    border-radius: var(--radius-sm);
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 16px;
  }

  .bunk-label {
    font-size: 14px;
    color: var(--text-secondary);
    font-weight: 600;
  }

  .bunk-value {
    font-size: 20px;
    font-weight: 900;
    color: var(--accent);
  }

  /* Message */
  .message-box {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(245, 87, 108, 0.08) 100%);
    border-radius: var(--radius-sm);
    padding: 16px;
    text-align: center;
    font-weight: 700;
    color: var(--text-primary);
    font-size: 14px;
  }

  /* Footer */
  .footer {
    padding: 16px 28px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 1px solid rgba(102, 126, 234, 0.1);
  }

  .footer-text {
    font-size: 12px;
    color: var(--text-muted);
    font-weight: 600;
  }

  .footer-target {
    font-size: 13px;
    font-weight: 700;
    color: var(--accent);
  }

  /* Roast Modal */
  .roast-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    padding: 20px;
  }

  .roast-modal {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border-radius: var(--radius);
    padding: 32px;
    max-width: 500px;
    width: 100%;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    animation: roastSlideIn 0.4s ease;
    border: 2px solid rgba(245, 87, 108, 0.3);
  }

  @keyframes roastSlideIn {
    from {
      opacity: 0;
      transform: scale(0.9) translateY(-20px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  .roast-text {
    font-size: 18px;
    line-height: 1.5;
    color: #ffdeea;
    font-weight: 800;
    margin-bottom: 20px;
    text-align: center;
  }

  .roast-close {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
    border: none;
    border-radius: var(--radius-sm);
    color: white;
    font-weight: 800;
    font-size: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .roast-close:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(245, 101, 101, 0.4);
  }

  /* Responsive */
  @media (min-width: 768px) {
    .content {
      grid-template-columns: 380px 1fr;
    }

    .targets-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .info-grid {
      grid-template-columns: 1fr 1fr;
    }
  }

  @media (max-width: 767px) {
    .header {
      padding: 20px;
    }

    .brand-title {
      font-size: 24px;
    }

    .percentage-value {
      font-size: 48px;
    }

    .sidebar, .main-display {
      padding: 20px;
    }

    .stats-card {
      padding: 20px;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="glass header">
      <div class="brand">
        <div class="brand-title">Attendance Calculator</div>
        <div class="brand-by">by <span class="brand-name">EliteStocks</span></div>
      </div>
      <div class="autosave-badge">
        <span class="autosave-dot"></span>
        <span>Autosave</span>
      </div>
    </div>

    <!-- Main Content -->
    <div class="content">
      <!-- Sidebar -->
      <div class="glass sidebar">
        <div>
          <div class="section-title">Target Percentage</div>
          <div class="targets-grid" id="targets">
            <button class="target-btn" data-val="75" aria-pressed="false">
              <span>75%</span>
            </button>
            <button class="target-btn" data-val="80" aria-pressed="false">
              <span>80%</span>
            </button>
            <button class="target-btn" data-val="85" aria-pressed="false">
              <span>85%</span>
            </button>
            <button class="target-btn" data-val="90" aria-pressed="false">
              <span>90%</span>
            </button>
          </div>
        </div>

        <div class="input-group">
          <label class="input-label" for="total">Total Classes</label>
          <input id="total" class="input-field" type="number" inputmode="numeric" min="0" value="60" />
        </div>

        <div class="input-group">
          <label class="input-label" for="attended">Classes Attended</label>
          <input id="attended" class="input-field" type="number" inputmode="numeric" min="0" value="45" />
        </div>

        <div class="btn-row">
          <button id="present" class="btn btn-primary">
            <span>+ Present</span>
          </button>
          <button id="absent" class="btn btn-secondary">
            <span>+ Absent</span>
          </button>
        </div>

        <div class="input-group">
          <label class="input-label" for="upcoming">Upcoming Classes</label>
          <input id="upcoming" class="input-field" type="number" inputmode="numeric" placeholder="Enter count" />
        </div>

        <div class="input-group">
          <label class="input-label" for="willAttend">Will Attend</label>
          <input id="willAttend" class="input-field" type="number" inputmode="numeric" placeholder="How many?" />
        </div>

        <div class="btn-row">
          <button id="apply" class="btn btn-secondary">
            <span>Apply</span>
          </button>
          <button id="reset" class="btn btn-danger">
            <span>Reset</span>
          </button>
        </div>
      </div>

      <!-- Main Display -->
      <div class="glass main-display">
        <div class="stats-card">
          <div class="stats-header">
            <div class="percentage-display">
              <div class="percentage-value" id="percent">0.00%</div>
              <div class="percentage-label">Current Attendance</div>
            </div>
            <div id="statusWrap">
              <span class="status-badge">—</span>
            </div>
          </div>

          <div class="info-grid">
            <div class="info-item">
              <div class="info-label">Projected</div>
              <div class="info-value" id="proj">0 / 0 — 0.00%</div>
            </div>
            <div class="info-item">
              <div class="info-label">Needed</div>
              <div class="info-value" id="needed">—</div>
            </div>
          </div>

          <div class="bunk-card">
            <div class="bunk-label" id="bunkLabel">You can bunk</div>
            <div class="bunk-value" id="bunkCount">—</div>
          </div>

          <div class="message-box" id="message">—</div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="glass footer">
      <div class="footer-text">EliteStocks © 2026</div>
      <div class="footer-target" id="currentTarget">Target: 75%</div>
    </div>
  </div>

  <!-- Roast Modal -->
  <div id="roastOverlay" class="roast-overlay">
    <div class="roast-modal">
      <div class="roast-text" id="roastText">You can't do that idiot. WTF are you doing?</div>
      <button id="roastClose" class="roast-close">Got It</button>
    </div>
  </div>

<script>
/* Liquid Glass Attendance Calculator by EliteStocks */

const $ = id => document.getElementById(id);
const totalEl = $('total'), attendedEl = $('attended'), upcomingEl = $('upcoming'), willAttendEl = $('willAttend');
const presentBtn = $('present'), absentBtn = $('absent'), applyBtn = $('apply'), resetBtn = $('reset');
const percentEl = $('percent'), statusWrap = $('statusWrap'), projEl = $('proj'), neededEl = $('needed');
const bunkLabel = $('bunkLabel'), bunkCount = $('bunkCount'), messageEl = $('message'), currentTargetEl = $('currentTarget');
const targets = Array.from(document.querySelectorAll('.target-btn'));
const roastOverlay = $('roastOverlay'), roastText = $('roastText'), roastClose = $('roastClose');

const KEY = 'att_elitestocks_v1';
function toInt(v){ const n = parseInt(String(v).replace(/[^\d-]/g,''),10); return isNaN(n) ? 0 : Math.max(0,n); }
function pct(att, tot){ return tot <= 0 ? 0 : (att / tot) * 100; }
function classesNeeded(att, tot, targetPct){
  const t = targetPct/100;
  if(pct(att,tot) >= targetPct) return 0;
  if(t >= 1) return Infinity;
  const numerator = t * tot - att;
  const denom = 1 - t;
  return Math.max(0, Math.ceil(numerator / denom));
}
function maxBunk(att, tot, targetPct){
  const t = targetPct/100;
  if(t === 0) return Infinity;
  if(pct(att,tot) < targetPct) return 0;
  const raw = (att - t*tot)/t;
  return Math.max(0, Math.floor(raw));
}

// Targets
function setTarget(v){
  targets.forEach(t => {
    const active = Number(t.dataset.val) === Number(v);
    t.classList.toggle('active', active);
    t.setAttribute('aria-pressed', active ? 'true' : 'false');
  });
  currentTargetEl.textContent = 'Target: ' + Number(v) + '%';
  update(true);
}
function getTarget(){ const a = targets.find(t => t.classList.contains('active')); return a ? Number(a.dataset.val) : 75; }
targets.forEach(t => t.addEventListener('click', ()=> setTarget(t.dataset.val)));

// Roast messages
let ROAST_POOL = null;
function buildRoastPool(n){
  if(ROAST_POOL && ROAST_POOL.length >= n) return ROAST_POOL;
  const starts = ["You can't do that", "You can't be serious", "What the fuck are you doing", "Sir, stop", "Stop right now", "Who told you to do that", "Are you for real", "You absolute idiot"];
  const middles = [
    "you can't enter more presents than total.",
    "you can't set attended higher than total.",
    "that's not how this works.",
    "this makes no sense at all.",
    "you're breaking logic here.",
    "you're trying nonsense inputs.",
    "you're being dumb with numbers."
  ];
  const jabs = [
    "You look like a fucking crazy person.",
    "You can't do that idiot.",
    "WTF are you doing?",
    "Bro, stop acting dumb.",
    "This is nonsense, fix it.",
    "You're trying to cheat reality, stop.",
    "Seriously, what are you thinking?"
  ];
  ROAST_POOL = [];
  const used = new Set();
  let attempts = 0;
  while(ROAST_POOL.length < n && attempts < n * 12){
    const a = starts[Math.floor(Math.random()*starts.length)];
    const b = middles[Math.floor(Math.random()*middles.length)];
    const c = jabs[Math.floor(Math.random()*jabs.length)];
    let msg = `${a} — ${b} ${Math.random()<0.5 ? c : ''}`.trim();
    msg = msg.replace(/\s+/g,' ').replace(/\s+—\s+$/,'').trim();
    if(Math.random() < 0.25) msg = msg.replace(/\.$/,'') + (Math.random()<0.5 ? '!' : '...');
    if(msg.length > 6 && !used.has(msg)){
      used.add(msg);
      ROAST_POOL.push(msg);
    }
    attempts++;
  }
  while(ROAST_POOL.length < n){
    ROAST_POOL.push(`You can't do that idiot. Stop it. (${ROAST_POOL.length+1})`);
  }
  return ROAST_POOL;
}
function pickRoast(){
  buildRoastPool(500);
  return ROAST_POOL[Math.floor(Math.random()*ROAST_POOL.length)];
}

// Roast UI
let roastTimer = null;
function showRoast(msg){
  roastText.textContent = msg || pickRoast();
  roastOverlay.style.display = 'flex';
  if(roastTimer) clearTimeout(roastTimer);
  roastTimer = setTimeout(()=>{ roastOverlay.style.display = 'none'; }, 4200);
}
roastClose.addEventListener('click', ()=>{ roastOverlay.style.display = 'none'; });
roastOverlay.addEventListener('click', (e)=>{ if(e.target === roastOverlay) roastOverlay.style.display = 'none'; });

// Persistence
function saveState(){
  try{
    localStorage.setItem(KEY, JSON.stringify({
      total: toInt(totalEl.value),
      attended: toInt(attendedEl.value),
      upcoming: toInt(upcomingEl.value),
      willAttend: toInt(willAttendEl.value),
      target: getTarget()
    }));
  }catch(e){}
}
function loadState(){
  try{
    const s = JSON.parse(localStorage.getItem(KEY) || '{}');
    if(typeof s.total === 'number') totalEl.value = s.total;
    if(typeof s.attended === 'number') attendedEl.value = s.attended;
    if(typeof s.upcoming === 'number') upcomingEl.value = s.upcoming;
    if(typeof s.willAttend === 'number') willAttendEl.value = s.willAttend;
    if(typeof s.target === 'number') setTarget(s.target);
  }catch(e){}
}

let prevAttended = toInt(attendedEl.value);
let prevWillAttend = toInt(willAttendEl.value);

// Update
let lastState = {};
function update(force){
  const total = toInt(totalEl.value);
  let attended = toInt(attendedEl.value);
  const upcoming = toInt(upcomingEl.value);
  let willAttend = toInt(willAttendEl.value);
  const target = getTarget();

  if(attended > total){
    attendedEl.value = prevAttended;
    attended = prevAttended;
    showRoast(pickRoast());
  } else {
    prevAttended = attended;
  }

  if(willAttend > upcoming){
    willAttendEl.value = prevWillAttend;
    willAttend = prevWillAttend;
  } else {
    prevWillAttend = willAttend;
  }

  const safeAtt = Math.min(attended, total);
  const curPct = +(pct(safeAtt, total).toFixed(2));
  const state = { total, safeAtt, upcoming, willAttend, curPct, target };
  if(!force && JSON.stringify(state) === JSON.stringify(lastState)) return;
  lastState = state;

  percentEl.textContent = curPct.toFixed(2) + '%';
  if(total === 0) statusWrap.innerHTML = `<span class="status-badge">—</span>`;
  else if(curPct >= target) statusWrap.innerHTML = `<span class="status-badge status-ok">ON TRACK</span>`;
  else statusWrap.innerHTML = `<span class="status-badge status-low">BELOW</span>`;

  const pTot = total + upcoming;
  const pAtt = safeAtt + willAttend;
  projEl.textContent = `${pAtt} / ${pTot} — ${ (pTot===0) ? '0.00%' : pct(pAtt,pTot).toFixed(2)+'%' }`;

  const needed = classesNeeded(attended, total, target);
  neededEl.textContent = needed === Infinity ? 'Impossible' : (needed + (needed===1 ? ' class' : ' classes'));

  if(total === 0 && attended === 0){
    bunkLabel.textContent = 'You can bunk';
    bunkCount.textContent = '—';
    messageEl.textContent='Enter your attendance data to get started';
  } else if(curPct >= target){
    const bunk = maxBunk(attended, total, target);
    bunkLabel.textContent = 'You can bunk';
    bunkCount.textContent = (bunk === Infinity) ? 'Many' : (bunk + (bunk===1 ? ' class' : ' classes'));
    messageEl.textContent = bunk > 0 ? `You can skip ${bunk} ${bunk===1?'class':'classes'} and still meet ${target}%` : 'On track — keep it up!';
  } else {
    const needCount = needed === Infinity ? 'Impossible' : (needed + (needed===1 ? ' class' : ' classes'));
    bunkLabel.textContent = 'You need';
    bunkCount.textContent = needCount;
    messageEl.textContent = 'Below target — attend more classes to improve';
  }

  saveState();
}

// Event listeners
attendedEl.addEventListener('focus', ()=> prevAttended = toInt(attendedEl.value));
attendedEl.addEventListener('input', ()=>{ update(); });

willAttendEl.addEventListener('focus', ()=> prevWillAttend = toInt(willAttendEl.value));
willAttendEl.addEventListener('input', ()=>{
  const entered = toInt(willAttendEl.value), upcoming = toInt(upcomingEl.value);
  if(entered > upcoming){ willAttendEl.value = prevWillAttend; } else { prevWillAttend = entered; update(); }
});

totalEl.addEventListener('input', ()=>{
  const total = toInt(totalEl.value), attended = toInt(attendedEl.value);
  if(attended > total){
    attendedEl.value = total;
    prevAttended = total;
  }
  update();
});
upcomingEl.addEventListener('input', update);

presentBtn.addEventListener('click', ()=>{
  totalEl.value = toInt(totalEl.value) + 1;
  attendedEl.value = toInt(attendedEl.value) + 1;
  prevAttended = toInt(attendedEl.value);
  update();
});

absentBtn.addEventListener('click', ()=>{
  totalEl.value = toInt(totalEl.value) + 1;
  update();
});

applyBtn.addEventListener('click', ()=>{
  const upcoming = toInt(upcomingEl.value);
  const willAttend = Math.min(toInt(willAttendEl.value), upcoming);
  totalEl.value = toInt(totalEl.value) + upcoming;
  attendedEl.value = toInt(attendedEl.value) + willAttend;
  prevAttended = toInt(attendedEl.value);
  upcomingEl.value = '';
  willAttendEl.value = '';
  update();
});

resetBtn.addEventListener('click', ()=>{
  if(confirm('Reset all attendance data?')){
    totalEl.value = 0;
    attendedEl.value = 0;
    upcomingEl.value = '';
    willAttendEl.value = '';
    setTarget(75);
    localStorage.removeItem(KEY);
    prevAttended = 0;
    prevWillAttend = 0;
    update(true);
  }
});

[totalEl, attendedEl, upcomingEl, willAttendEl].forEach(inp=>{
  inp.addEventListener('keydown', (e) => {
    if(e.key === 'Enter'){ inp.blur(); update(); }
  });
});

// Init
function loadAndStart(){
  loadState();
  if(!targets.some(t=>t.classList.contains('active'))) setTarget(75);
  update(true);
}
loadAndStart();
</script>
</body>
</html>
